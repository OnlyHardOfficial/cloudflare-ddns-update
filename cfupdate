
#!/bin/bash
source /etc/cfconfig

  for record_name in "${records[@]}"
  do
    # DO NOT CHANGE LINES BELOW
    ip=$(curl -s https://ipv4.icanhazip.com/)

    # SCRIPT START
    echo "[Cloudflare DDNS] Check Initiated for <$record_name>"

    # Seek for the record
    record=$(curl -s -X GET "https://api.cloudflare.com/client/v4/zones/$zone_identif>

    # Can't do anything without the record
    if [[ $record == *"\"count\": 0"* ]] || [[ $record == *"\"count\":0"* ]]; then
      >&2 echo -e "[Cloudflare DDNS] Record <$record_name> does not exist, perhaps cr>
      continue
    fi

    # Set existing IP address from the fetched record
    old_ip=$(echo "$record" | grep -Po '(?<="content":")[^"]*' | head -1 | xargs)

    # Compare if they're the same
    if [ $ip == $old_ip ]; then
      echo "[Cloudflare DDNS] IP has not changed for record <$record_name>."
      continue
    fi

    # Set the record identifier from result
    record_identifier=$(echo "$record" | grep -Po '(?<="id":")[^"]*' | head -1 | xarg>

    proxied=true
    if [[ $record_name == $not_proxied ]]; then
      proxied=false
    fi
    # The execution of update
    update=$(curl -s -X PUT "https://api.cloudflare.com/client/v4/zones/$zone_identif>

    # The moment of truth
    case "$update" in
    *"\"success\":false"*)
      >&2 echo -e "[Cloudflare DDNS] Update <$record_name> failed for $record_identif>
      continue;;
    *"\"success\": false"*)
      >&2 echo -e "[Cloudflare DDNS] Update <$record_name> failed for $record_identif>
      continue;;
    *)
      echo "[Cloudflare DDNS] IPv4 context '$ip' has been synced to Cloudflare for <$>
    esac
  done
